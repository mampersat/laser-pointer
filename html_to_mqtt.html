<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse Coordinates over MQTT</title>
    <!-- Ensure correct and accessible CDN link for Paho MQTT library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js"></script>
    <!-- Include the refactored MQTT handler -->
    <script src="mqttHandler.js"></script>
    <style>
        body {
            background-color: #121212;
            /* Dark background */
            color: #e0e0e0;
            /* Light text */
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
        }

        .container {
            display: flex;
            width: 100%;
            height: 100vh;
        }

        .left-panel,
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .right-panel {
            background: url('images/nat_geo_the_world.jpg') no-repeat center center;
            background-size: contain;
        }

        .status {
            margin-top: 20px;
            font-size: 20px;
            color: #90ee90;
            /* Light green for status messages for better visibility */
        }

        .log-window {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background-color: #333;
            color: #fff;
            overflow-y: auto;
            padding: 10px;
            box-sizing: border-box;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="left-panel">
            <h1>Mouse Coordinates Sender</h1>
            <p>Click anywhere to toggle tracking of mouse coordinates.</p>
            <p class="status" id="status">Tracking: OFF</p>
        </div>
        <div class="right-panel"></div>
    </div>

    <div class="log-window" id="logWindow">Log Messages:</div>

    <script>
        let isTracking = false;
        const statusElement = document.getElementById('status');
        let lastMouseCoords = { x: 0, y: 0 }; // Global variable to store the last mouse coordinates

        // Event listener for mouse move
        function mouseMoveHandler(event) {
            const x = event.clientX;
            const y = event.clientY;

            lastMouseCoords = { x, y };

            if (isTracking) {
                // Check if the mouse is on the left side of the page
                if (event.clientX > document.documentElement.clientWidth / 2) {
                    return; // Do nothing if the mouse is on the right side
                }

                // convert mouse co-ords from left panel dimensions to 0-1000 
                leftPanelElement = document.querySelector('.left-panel');
                turret_x = Math.round((x / leftPanelElement.clientWidth) * 1000);
                turret_y = Math.round((y / leftPanelElement.clientHeight) * 1000);
                sendMouseCoords(turret_x, turret_y);
            }
        }

        function enterClickedHandler(event) {
            const clientWidth = document.documentElement.clientWidth;
            const logWindow = document.getElementById('logWindow');

            if (event.key === "Enter") {
                const panelSide = lastMouseCoords.x > clientWidth / 2 ? 'Right' : 'Left';

                logWindow.innerHTML += `<p>Last Mouse Position: (${lastMouseCoords.x}, ${lastMouseCoords.y}) - ${panelSide} Panel</p>`;
                logWindow.scrollTop = logWindow.scrollHeight; // Auto-scroll to the latest log message
            }
        }

        // Toggle tracking function
        function toggleTracking() {
            isTracking = !isTracking;
            if (isTracking) {
                statusElement.textContent = "Tracking: ON";
            } else {
                statusElement.textContent = "Tracking: OFF";
            }
        }
        document.addEventListener('keypress', enterClickedHandler);
        document.addEventListener('click', toggleTracking);
        document.addEventListener('mousemove', mouseMoveHandler);
    </script>

</body>

</html>