<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse Coordinates over MQTT</title>
    <!-- Ensure correct and accessible CDN link for Paho MQTT library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .status {
            margin-top: 20px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <h1>Mouse Coordinates Sender</h1>
    <p>Click anywhere to toggle tracking of mouse coordinates.</p>
    <p class="status" id="status">Tracking: OFF</p>

    <script>
        // MQTT Broker details
        const MQTT_BROKER = "broker.hivemq.com";
        const MQTT_PORT = 8884;
        const MQTT_TOPIC = "com/mampersat/mousecoords";

        // Create a client instance
        const clientID = "mqtt_js_" + Math.random().toString(16).substr(2, 8);
        const client = new Paho.Client(MQTT_BROKER, MQTT_PORT, clientID);

        // Set callback handlers
        client.onConnectionLost = function (responseObject) {
            if (responseObject.errorCode !== 0) {
                console.log("onConnectionLost:", responseObject.errorMessage);
            }
        };

        client.onMessageArrived = function (message) {
            console.log("onMessageArrived:", message.payloadString);
        };

        // Connect the client
        client.connect({
            onSuccess: onConnect,
            useSSL: true
        });

        // Called when the client connects
        function onConnect() {
            console.log("Connected to MQTT broker");
            // Optionally subscribe to a topic
            // client.subscribe(MQTT_TOPIC);
        }

        // Send mouse coordinates over MQTT
        function sendMouseCoords(x, y) {
            const message = new Paho.Message(JSON.stringify({ x: x, y: y }));
            message.destinationName = MQTT_TOPIC;
            client.send(message);
        }

        let isTracking = false;
        const statusElement = document.getElementById('status');

        // Event listener for mouse move
        function mouseMoveHandler(event) {
            if (isTracking) {
                const x = event.clientX;
                const y = event.clientY;
                sendMouseCoords(x, y);
            }
        }

        // Toggle tracking function
        function toggleTracking() {
            isTracking = !isTracking;
            if (isTracking) {
                document.addEventListener('mousemove', mouseMoveHandler);
                statusElement.textContent = "Tracking: ON";
            } else {
                document.removeEventListener('mousemove', mouseMoveHandler);
                statusElement.textContent = "Tracking: OFF";
            }
        }

        // Add click event listener to the entire document
        document.addEventListener('click', toggleTracking);
    </script>
</body>
</html>
