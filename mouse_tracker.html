<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse Coordinates over MQTT 2</title>
    <!-- Ensure correct and accessible CDN link for Paho MQTT library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js"></script>
</head>
<body>
    <h1>Mouse Coordinates Sender</h1>
    <p>Move your mouse around to send coordinates over MQTT.</p>
    <button id="toggleTracking">Start Tracking</button>
    
    <script>
        // MQTT Broker details
        const MQTT_BROKER = "broker.hivemq.com";
        const MQTT_PORT = 8000;
        const MQTT_TOPIC = "com/mampersat/mousecoords";

        // Create a client instance
        const clientID = "mqtt_js_" + Math.random().toString(16).substr(2, 8);
        const client = new Paho.Client(MQTT_BROKER, MQTT_PORT, clientID);

        // Set callback handlers
        client.onConnectionLost = function (responseObject) {
            if (responseObject.errorCode !== 0) {
                console.log("onConnectionLost:", responseObject.errorMessage);
            }
        };

        client.onMessageArrived = function (message) {
            console.log("onMessageArrived:", message.payloadString);
        };

        // Connect the client
        client.connect({
            onSuccess: onConnect,
            useSSL: true
        });

        // Called when the client connects
        function onConnect() {
            console.log("Connected to MQTT broker");
            // Optionally subscribe to a topic
            // client.subscribe(MQTT_TOPIC);
        }

        // Send mouse coordinates over MQTT
        function sendMouseCoords(x, y) {
            const message = new Paho.Message(JSON.stringify({ x: x, y: y }));
            message.destinationName = MQTT_TOPIC;
            client.send(message);
        }

        let isTracking = false;
        const toggleTrackingButton = document.getElementById('toggleTracking');

        // Event listener for mouse move
        function mouseMoveHandler(event) {
            if (isTracking) {
                const x = event.clientX;
                const y = event.clientY;
                sendMouseCoords(x, y);
            }
        }

        // Toggle tracking function
        function toggleTracking() {
            isTracking = !isTracking;
            if (isTracking) {
                document.addEventListener('mousemove', mouseMoveHandler);
                toggleTrackingButton.textContent = "Stop Tracking";
            } else {
                document.removeEventListener('mousemove', mouseMoveHandler);
                toggleTrackingButton.textContent = "Start Tracking";
            }
        }

        // Add click event listener to the button
        toggleTrackingButton.addEventListener('click', toggleTracking);
    </script>
</body>
</html>
